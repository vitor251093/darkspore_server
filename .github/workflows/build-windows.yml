name: Build (Windows x64)

on:
  push:
    branches:
      - master
      - merge/dalkon_2
  pull_request:
    branches:
      - master

env:
  BUILD_TYPE: Release

jobs:
  build:
    runs-on: windows-latest
    name: Build
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install Boost
        uses: MarkusJx/install-boost@v2.4.1
        with:
          boost_version: 1.73.0
          boost_install_dir: ${{ runner.workspace }}\recap_server\darkspore_server\libs\boost_1_73_0
          platform_version: 2019

      - name: Install MSBuild
        uses: microsoft/setup-msbuild@v1

      - name: List include files
        run: dir ${{ github.workspace }}\darkspore_server\source\blaze

      - name: Run MSBuild
        working-directory: ${{ github.workspace }}
        run: |
          msbuild .\darkspore_server.sln /p:Configuration=Release /p:Platform=x64 /p:IncludePath="${{ github.workspace }}\darkspore_server\source;${{ github.workspace }}\darkspore_server\libs\boost_1_73_0\include" /p:LibraryPath="${{ github.workspace }}\darkspore_server\libs\boost_1_73_0\lib"

      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: recap-server-windows-x64
          path: ${{ runner.workspace }}\recap_server\darkspore_server\build
